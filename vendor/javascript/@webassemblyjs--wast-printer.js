import n from"@webassemblyjs/ast";import t from"@xtuc/long";var r={};Object.defineProperty(r,"__esModule",{value:true});r.print=print;var e=n;var i=_interopRequireDefault(t);function _interopRequireDefault(n){return n&&n.__esModule?n:{default:n}}function _typeof(n){_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function _typeof(n){return typeof n}:function _typeof(n){return n&&"function"===typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};return _typeof(n)}function _sliceIterator(n,t){var r=[];var e=true;var i=false;var o=void 0;try{for(var a=n[Symbol.iterator](),u;!(e=(u=a.next()).done);e=true){r.push(u.value);if(t&&r.length===t)break}}catch(n){i=true;o=n}finally{try{e||null==a["return"]||a["return"]()}finally{if(i)throw o}}return r}function _slicedToArray(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return _sliceIterator(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}var o=false;var a=" ";var u=function quote(n){return'"'.concat(n,'"')};function indent(n){return Array(n).fill(a+a).join("")}function print(n){if("Program"===n.type)return printProgram(n,0);throw new Error("Unsupported node in print of type: "+String(n.type))}function printProgram(n,t){return n.body.reduce((function(n,r){"Module"===r.type&&(n+=printModule(r,t+1));"Func"===r.type&&(n+=printFunc(r,t+1));"BlockComment"===r.type&&(n+=printBlockComment(r));"LeadingComment"===r.type&&(n+=printLeadingComment(r));false===o&&(n+="\n");return n}),"")}function printTypeInstruction(n){var t="";t+="(";t+="type";t+=a;if(null!=n.id){t+=printIndex(n.id);t+=a}t+="(";t+="func";n.functype.params.forEach((function(n){t+=a;t+="(";t+="param";t+=a;t+=printFuncParam(n);t+=")"}));n.functype.results.forEach((function(n){t+=a;t+="(";t+="result";t+=a;t+=n;t+=")"}));t+=")";t+=")";return t}function printModule(n,t){var r="(";r+="module";if("string"===typeof n.id){r+=a;r+=n.id}r+=false===o?"\n":a;n.fields.forEach((function(n){false===o&&(r+=indent(t));switch(n.type){case"Func":r+=printFunc(n,t+1);break;case"TypeInstruction":r+=printTypeInstruction(n);break;case"Table":r+=printTable(n);break;case"Global":r+=printGlobal(n,t+1);break;case"ModuleExport":r+=printModuleExport(n);break;case"ModuleImport":r+=printModuleImport(n);break;case"Memory":r+=printMemory(n);break;case"BlockComment":r+=printBlockComment(n);break;case"LeadingComment":r+=printLeadingComment(n);break;case"Start":r+=printStart(n);break;case"Elem":r+=printElem(n,t);break;case"Data":r+=printData(n,t);break;default:throw new Error("Unsupported node in printModule: "+String(n.type))}false===o&&(r+="\n")}));r+=")";return r}function printData(n,t){var r="";r+="(";r+="data";r+=a;r+=printIndex(n.memoryIndex);r+=a;r+=printInstruction(n.offset,t);r+=a;r+='"';n.init.values.forEach((function(n){if(n<=31||34==n||92==n||n>=127){r+="\\";r+=("00"+n.toString(16)).substr(-2)}else{if(n>255)throw new Error("Unsupported byte in data segment: "+n);r+=String.fromCharCode(n)}}));r+='"';r+=")";return r}function printElem(n,t){var r="";r+="(";r+="elem";r+=a;r+=printIndex(n.table);var e=_slicedToArray(n.offset,1),i=e[0];r+=a;r+="(";r+="offset";r+=a;r+=printInstruction(i,t);r+=")";n.funcs.forEach((function(n){r+=a;r+=printIndex(n)}));r+=")";return r}function printStart(n){var t="";t+="(";t+="start";t+=a;t+=printIndex(n.index);t+=")";return t}function printLeadingComment(n){if(true===o)return"";var t="";t+=";;";t+=n.value;t+="\n";return t}function printBlockComment(n){if(true===o)return"";var t="";t+="(;";t+=n.value;t+=";)";t+="\n";return t}function printSignature(n){var t="";n.params.forEach((function(n){t+=a;t+="(";t+="param";t+=a;t+=printFuncParam(n);t+=")"}));n.results.forEach((function(n){t+=a;t+="(";t+="result";t+=a;t+=n;t+=")"}));return t}function printModuleImportDescr(n){var t="";if("FuncImportDescr"===n.type){t+="(";t+="func";if(false===(0,e.isAnonymous)(n.id)){t+=a;t+=printIdentifier(n.id)}t+=printSignature(n.signature);t+=")"}if("GlobalType"===n.type){t+="(";t+="global";t+=a;t+=printGlobalType(n);t+=")"}"Table"===n.type&&(t+=printTable(n));return t}function printModuleImport(n){var t="";t+="(";t+="import";t+=a;t+=u(n.module);t+=a;t+=u(n.name);t+=a;t+=printModuleImportDescr(n.descr);t+=")";return t}function printGlobalType(n){var t="";if("var"===n.mutability){t+="(";t+="mut";t+=a;t+=n.valtype;t+=")"}else t+=n.valtype;return t}function printGlobal(n,t){var r="";r+="(";r+="global";r+=a;if(null!=n.name&&false===(0,e.isAnonymous)(n.name)){r+=printIdentifier(n.name);r+=a}r+=printGlobalType(n.globalType);r+=a;n.init.forEach((function(n){r+=printInstruction(n,t+1)}));r+=")";return r}function printTable(n){var t="";t+="(";t+="table";t+=a;if(null!=n.name&&false===(0,e.isAnonymous)(n.name)){t+=printIdentifier(n.name);t+=a}t+=printLimit(n.limits);t+=a;t+=n.elementType;t+=")";return t}function printFuncParam(n){var t="";if("string"===typeof n.id){t+="$"+n.id;t+=a}t+=n.valtype;return t}function printFunc(n,t){var r="";r+="(";r+="func";if(null!=n.name&&"Identifier"===n.name.type&&false===(0,e.isAnonymous)(n.name)){r+=a;r+=printIdentifier(n.name)}if("Signature"===n.signature.type)r+=printSignature(n.signature);else{var i=n.signature;r+=a;r+="(";r+="type";r+=a;r+=printIndex(i);r+=")"}if(n.body.length>0){if(1===n.body.length&&"end"===n.body[0].id){r+=")";return r}false===o&&(r+="\n");n.body.forEach((function(n){if("end"!==n.id){r+=indent(t);r+=printInstruction(n,t);false===o&&(r+="\n")}}));r+=indent(t-1)+")"}else r+=")";return r}function printInstruction(n,t){switch(n.type){case"Instr":return printGenericInstruction(n,t+1);case"BlockInstruction":return printBlockInstruction(n,t+1);case"IfInstruction":return printIfInstruction(n,t+1);case"CallInstruction":return printCallInstruction(n,t+1);case"CallIndirectInstruction":return printCallIndirectIntruction(n,t+1);case"LoopInstruction":return printLoopInstruction(n,t+1);default:throw new Error("Unsupported instruction: "+JSON.stringify(n.type))}}function printCallIndirectIntruction(n,t){var r="";r+="(";r+="call_indirect";if("Signature"===n.signature.type)r+=printSignature(n.signature);else{if("Identifier"!==n.signature.type)throw new Error("CallIndirectInstruction: unsupported signature "+JSON.stringify(n.signature.type));r+=a;r+="(";r+="type";r+=a;r+=printIdentifier(n.signature);r+=")"}r+=a;null!=n.intrs&&n.intrs.forEach((function(e,i){r+=printInstruction(e,t+1);i!==n.intrs.length-1&&(r+=a)}));r+=")";return r}function printLoopInstruction(n,t){var r="";r+="(";r+="loop";if(null!=n.label&&false===(0,e.isAnonymous)(n.label)){r+=a;r+=printIdentifier(n.label)}if("string"===typeof n.resulttype){r+=a;r+="(";r+="result";r+=a;r+=n.resulttype;r+=")"}if(n.instr.length>0){n.instr.forEach((function(n){false===o&&(r+="\n");r+=indent(t);r+=printInstruction(n,t+1)}));if(false===o){r+="\n";r+=indent(t-1)}}r+=")";return r}function printCallInstruction(n,t){var r="";r+="(";r+="call";r+=a;r+=printIndex(n.index);"object"===_typeof(n.instrArgs)&&n.instrArgs.forEach((function(n){r+=a;r+=printFuncInstructionArg(n,t+1)}));r+=")";return r}function printIfInstruction(n,t){var r="";r+="(";r+="if";if(null!=n.testLabel&&false===(0,e.isAnonymous)(n.testLabel)){r+=a;r+=printIdentifier(n.testLabel)}if("string"===typeof n.result){r+=a;r+="(";r+="result";r+=a;r+=n.result;r+=")"}if(n.test.length>0){r+=a;n.test.forEach((function(n){r+=printInstruction(n,t+1)}))}if(n.consequent.length>0){false===o&&(r+="\n");r+=indent(t);r+="(";r+="then";t++;n.consequent.forEach((function(n){false===o&&(r+="\n");r+=indent(t);r+=printInstruction(n,t+1)}));t--;if(false===o){r+="\n";r+=indent(t)}r+=")"}else{if(false===o){r+="\n";r+=indent(t)}r+="(";r+="then";r+=")"}if(n.alternate.length>0){false===o&&(r+="\n");r+=indent(t);r+="(";r+="else";t++;n.alternate.forEach((function(n){false===o&&(r+="\n");r+=indent(t);r+=printInstruction(n,t+1)}));t--;if(false===o){r+="\n";r+=indent(t)}r+=")"}else{if(false===o){r+="\n";r+=indent(t)}r+="(";r+="else";r+=")"}if(false===o){r+="\n";r+=indent(t-1)}r+=")";return r}function printBlockInstruction(n,t){var r="";r+="(";r+="block";if(null!=n.label&&false===(0,e.isAnonymous)(n.label)){r+=a;r+=printIdentifier(n.label)}if("string"===typeof n.result){r+=a;r+="(";r+="result";r+=a;r+=n.result;r+=")"}if(n.instr.length>0){n.instr.forEach((function(n){false===o&&(r+="\n");r+=indent(t);r+=printInstruction(n,t+1)}));false===o&&(r+="\n");r+=indent(t-1);r+=")"}else r+=")";return r}function printGenericInstruction(n,t){var r="";r+="(";if("string"===typeof n.object){r+=n.object;r+="."}r+=n.id;n.args.forEach((function(n){r+=a;r+=printFuncInstructionArg(n,t+1)}));r+=")";return r}function printLongNumberLiteral(n){if("string"===typeof n.raw)return n.raw;var t=n.value,r=t.low,e=t.high;var o=new i.default(r,e);return o.toString()}function printFloatLiteral(n){return"string"===typeof n.raw?n.raw:String(n.value)}function printFuncInstructionArg(n,t){var r="";"NumberLiteral"===n.type&&(r+=printNumberLiteral(n));"LongNumberLiteral"===n.type&&(r+=printLongNumberLiteral(n));"Identifier"===n.type&&false===(0,e.isAnonymous)(n)&&(r+=printIdentifier(n));"ValtypeLiteral"===n.type&&(r+=n.name);"FloatLiteral"===n.type&&(r+=printFloatLiteral(n));(0,e.isInstruction)(n)&&(r+=printInstruction(n,t+1));return r}function printNumberLiteral(n){return"string"===typeof n.raw?n.raw:String(n.value)}function printModuleExport(n){var t="";t+="(";t+="export";t+=a;t+=u(n.name);if("Func"===n.descr.exportType){t+=a;t+="(";t+="func";t+=a;t+=printIndex(n.descr.id);t+=")"}else if("Global"===n.descr.exportType){t+=a;t+="(";t+="global";t+=a;t+=printIndex(n.descr.id);t+=")"}else if("Memory"===n.descr.exportType||"Mem"===n.descr.exportType){t+=a;t+="(";t+="memory";t+=a;t+=printIndex(n.descr.id);t+=")"}else{if("Table"!==n.descr.exportType)throw new Error("printModuleExport: unknown type: "+n.descr.exportType);t+=a;t+="(";t+="table";t+=a;t+=printIndex(n.descr.id);t+=")"}t+=")";return t}function printIdentifier(n){return"$"+n.value}function printIndex(n){if("Identifier"===n.type)return printIdentifier(n);if("NumberLiteral"===n.type)return printNumberLiteral(n);throw new Error("Unsupported index: "+n.type)}function printMemory(n){var t="";t+="(";t+="memory";if(null!=n.id){t+=a;t+=printIndex(n.id);t+=a}t+=printLimit(n.limits);t+=")";return t}function printLimit(n){var t="";t+=n.min+"";if(null!=n.max){t+=a;t+=String(n.max)}return t}const l=r.__esModule;const p=r.print;export default r;export{l as __esModule,p as print};

