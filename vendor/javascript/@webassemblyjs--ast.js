import e from"./nodes.js";import t from"@webassemblyjs/wast-parser";import r from"./traverse.js";import n from"./signatures.js";import o from"@webassemblyjs/helper-wasm-bytecode";import i from"./clone.js";var a={};Object.defineProperty(a,"__esModule",{value:true});a.numberLiteralFromRaw=numberLiteralFromRaw;a.instruction=instruction;a.objectInstruction=objectInstruction;a.withLoc=withLoc;a.withRaw=withRaw;a.funcParam=funcParam;a.indexLiteral=indexLiteral;a.memIndexLiteral=memIndexLiteral;var u=t;var c=e;function numberLiteralFromRaw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"i32";var r=e;"string"===typeof e&&(e=e.replace(/_/g,""));if("number"===typeof e)return(0,c.numberLiteral)(e,String(r));switch(t){case"i32":return(0,c.numberLiteral)((0,u.parse32I)(e),String(r));case"u32":return(0,c.numberLiteral)((0,u.parseU32)(e),String(r));case"i64":return(0,c.longNumberLiteral)((0,u.parse64I)(e),String(r));case"f32":return(0,c.floatLiteral)((0,u.parse32F)(e),(0,u.isNanLiteral)(e),(0,u.isInfLiteral)(e),String(r));default:return(0,c.floatLiteral)((0,u.parse64F)(e),(0,u.isNanLiteral)(e),(0,u.isInfLiteral)(e),String(r))}}function instruction(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,c.instr)(e,void 0,t,r)}function objectInstruction(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,c.instr)(e,t,r,n)}function withLoc(e,t,r){var n={start:r,end:t};e.loc=n;return e}function withRaw(e,t){e.raw=t;return e}function funcParam(e,t){return{id:t,valtype:e}}function indexLiteral(e){var t=numberLiteralFromRaw(e,"u32");return t}function memIndexLiteral(e){var t=numberLiteralFromRaw(e,"u32");return t}var f={};Object.defineProperty(f,"__esModule",{value:true});f.isAnonymous=isAnonymous;f.getSectionMetadata=getSectionMetadata;f.getSectionMetadatas=getSectionMetadatas;f.sortSectionMetadata=sortSectionMetadata;f.orderedInsertNode=orderedInsertNode;f.assertHasLoc=assertHasLoc;f.getEndOfSection=getEndOfSection;f.shiftLoc=shiftLoc;f.shiftSection=shiftSection;f.signatureForOpcode=signatureForOpcode;f.getUniqueNameGenerator=getUniqueNameGenerator;f.getStartByteOffset=getStartByteOffset;f.getEndByteOffset=getEndByteOffset;f.getFunctionBeginingByteOffset=getFunctionBeginingByteOffset;f.getEndBlockByteOffset=getEndBlockByteOffset;f.getStartBlockByteOffset=getStartBlockByteOffset;var s=n;var l=r;var d=_interopRequireWildcard(o);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}t.default=e;return t}function _sliceIterator(e,t){var r=[];var n=true;var o=false;var i=void 0;try{for(var a=e[Symbol.iterator](),u;!(n=(u=a.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){o=true;i=e}finally{try{n||null==a["return"]||a["return"]()}finally{if(o)throw i}}return r}function _slicedToArray(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return _sliceIterator(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _typeof(e){_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};return _typeof(e)}function isAnonymous(e){return""===e.raw}function getSectionMetadata(e,t){var r;(0,l.traverse)(e,{SectionMetadata:function(e){function SectionMetadata(t){return e.apply(this,arguments)}SectionMetadata.toString=function(){return e.toString()};return SectionMetadata}((function(e){var n=e.node;n.section===t&&(r=n)}))});return r}function getSectionMetadatas(e,t){var r=[];(0,l.traverse)(e,{SectionMetadata:function(e){function SectionMetadata(t){return e.apply(this,arguments)}SectionMetadata.toString=function(){return e.toString()};return SectionMetadata}((function(e){var n=e.node;n.section===t&&r.push(n)}))});return r}function sortSectionMetadata(e){null!=e.metadata?e.metadata.sections.sort((function(e,t){var r=d.default.sections[e.section];var n=d.default.sections[t.section];if("number"!==typeof r||"number"!==typeof n)throw new Error("Section id not found");return r-n})):console.warn("sortSectionMetadata: no metadata to sort")}function orderedInsertNode(e,t){assertHasLoc(t);var r=false;if("ModuleExport"!==t.type){e.fields=e.fields.reduce((function(e,n){var o=Infinity;null!=n.loc&&(o=n.loc.end.column);if(false===r&&t.loc.start.column<o){r=true;e.push(t)}e.push(n);return e}),[]);false===r&&e.fields.push(t)}else e.fields.push(t)}function assertHasLoc(e){if(null==e.loc||null==e.loc.start||null==e.loc.end)throw new Error("Internal failure: node (".concat(JSON.stringify(e.type),") has no location information"))}function getEndOfSection(e){assertHasLoc(e.size);return e.startOffset+e.size.value+(e.size.loc.end.column-e.size.loc.start.column)}function shiftLoc(e,t){e.loc.start.column+=t;e.loc.end.column+=t}function shiftSection(e,t,r){if("SectionMetadata"!==t.type)throw new Error("Can not shift node "+JSON.stringify(t.type));t.startOffset+=r;"object"===_typeof(t.size.loc)&&shiftLoc(t.size,r);"object"===_typeof(t.vectorOfSize)&&"object"===_typeof(t.vectorOfSize.loc)&&shiftLoc(t.vectorOfSize,r);var n=t.section;(0,l.traverse)(e,{Node:function Node(e){var t=e.node;var o=(0,d.getSectionForNode)(t);o===n&&"object"===_typeof(t.loc)&&shiftLoc(t,r)}})}function signatureForOpcode(e,t){var r=t;void 0!==e&&""!==e&&(r=e+"."+t);var n=s.signatures[r];return void 0==n?[e,e]:n[0]}function getUniqueNameGenerator(){var e={};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"temp";e[t]=t in e?e[t]+1:0;return t+"_"+e[t]}}function getStartByteOffset(e){if("undefined"===typeof e.loc||"undefined"===typeof e.loc.start)throw new Error("Can not get byte offset without loc informations, node: "+String(e.id));return e.loc.start.column}function getEndByteOffset(e){if("undefined"===typeof e.loc||"undefined"===typeof e.loc.end)throw new Error("Can not get byte offset without loc informations, node: "+e.type);return e.loc.end.column}function getFunctionBeginingByteOffset(e){if(!(e.body.length>0))throw new Error("n.body.length > 0"+" error: "+(void 0||"unknown"));var t=_slicedToArray(e.body,1),r=t[0];return getStartByteOffset(r)}function getEndBlockByteOffset(e){if(!(e.instr.length>0||e.body.length>0))throw new Error("n.instr.length > 0 || n.body.length > 0"+" error: "+(void 0||"unknown"));var t;e.instr&&(t=e.instr[e.instr.length-1]);e.body&&(t=e.body[e.body.length-1]);if(!("object"===_typeof(t)))throw new Error('typeof lastInstruction === "object"'+" error: "+(void 0||"unknown"));return getStartByteOffset(t)}function getStartBlockByteOffset(e){if(!(e.instr.length>0||e.body.length>0))throw new Error("n.instr.length > 0 || n.body.length > 0"+" error: "+(void 0||"unknown"));var t;if(e.instr){var r=_slicedToArray(e.instr,1);t=r[0]}if(e.body){var n=_slicedToArray(e.body,1);t=n[0]}if(!("object"===_typeof(t)))throw new Error('typeof fistInstruction === "object"'+" error: "+(void 0||"unknown"));return getStartByteOffset(t)}var y={};Object.defineProperty(y,"__esModule",{value:true});var g={numberLiteralFromRaw:true,withLoc:true,withRaw:true,funcParam:true,indexLiteral:true,memIndexLiteral:true,instruction:true,objectInstruction:true,traverse:true,signatures:true,cloneNode:true};Object.defineProperty(y,"numberLiteralFromRaw",{enumerable:true,get:function get(){return b.numberLiteralFromRaw}});Object.defineProperty(y,"withLoc",{enumerable:true,get:function get(){return b.withLoc}});Object.defineProperty(y,"withRaw",{enumerable:true,get:function get(){return b.withRaw}});Object.defineProperty(y,"funcParam",{enumerable:true,get:function get(){return b.funcParam}});Object.defineProperty(y,"indexLiteral",{enumerable:true,get:function get(){return b.indexLiteral}});Object.defineProperty(y,"memIndexLiteral",{enumerable:true,get:function get(){return b.memIndexLiteral}});Object.defineProperty(y,"instruction",{enumerable:true,get:function get(){return b.instruction}});Object.defineProperty(y,"objectInstruction",{enumerable:true,get:function get(){return b.objectInstruction}});Object.defineProperty(y,"traverse",{enumerable:true,get:function get(){return p.traverse}});Object.defineProperty(y,"signatures",{enumerable:true,get:function get(){return v.signatures}});Object.defineProperty(y,"cloneNode",{enumerable:true,get:function get(){return h.cloneNode}});var m=e;Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(g,e)||Object.defineProperty(y,e,{enumerable:true,get:function get(){return m[e]}}))}));var b=a;var p=r;var v=n;var w=f;Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(g,e)||Object.defineProperty(y,e,{enumerable:true,get:function get(){return w[e]}}))}));var h=i;const O=y.__esModule,S=y.numberLiteralFromRaw,L=y.withLoc,j=y.withRaw,_=y.funcParam,P=y.indexLiteral,I=y.memIndexLiteral,B=y.instruction,M=y.objectInstruction,E=y.traverse,x=y.signatures,R=y.cloneNode;export default y;export{O as __esModule,R as cloneNode,_ as funcParam,P as indexLiteral,B as instruction,I as memIndexLiteral,S as numberLiteralFromRaw,M as objectInstruction,x as signatures,E as traverse,L as withLoc,j as withRaw};

