import e from"aproba";var u="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var r={};r=RunQueue;var i=e;function RunQueue(e){i("Z|O",[e]);e||(e={});this.finished=false;this.inflight=0;this.maxConcurrency=e.maxConcurrency||1;this.queued=0;this.queue=[];this.currentPrio=null;this.currentQueue=null;this.Promise=e.Promise||u.Promise;this.deferred={}}RunQueue.prototype={};RunQueue.prototype.run=function(){if(0!==arguments.length)throw new Error("RunQueue.run takes no arguments");var e=this;var u=this.deferred;u.promise||(u.promise=new this.Promise((function(r,i){u.resolve=r;u.reject=i;e._runQueue()})));return u.promise};RunQueue.prototype._runQueue=function(){var e=this;while(this.inflight<this.maxConcurrency&&this.queued){if(!this.currentQueue||0===this.currentQueue.length){if(this.inflight)return;var u=Object.keys(this.queue);for(var r=0;r<u.length;++r){var i=this.queue[u[r]];if(i.length){this.currentQueue=i;this.currentPrio=u[r];break}}}--this.queued;++this.inflight;var t=this.currentQueue.shift();var n=t.args||[];var s=new this.Promise((function(e){e(t.cmd.apply(null,n))}));s.then((function(){--e.inflight;if(!e.finished){if(e.queued<=0&&e.inflight<=0){e.finished=true;e.deferred.resolve()}e._runQueue()}}),(function(u){e.finished=true;e.deferred.reject(u)}))}};RunQueue.prototype.add=function(e,u,r){if(this.finished)throw new Error("Can't add to a finished queue. Create a new queue.");if(Math.abs(Math.floor(e))!==e)throw new Error("Priorities must be a positive integer value.");i("NFA|NFZ",[e,u,r]);e=Number(e);this.queue[e]||(this.queue[e]=[]);++this.queued;this.queue[e].push({cmd:u,args:r});if(this.currentPrio>e){this.currentQueue=this.queue[e];this.currentPrio=e}};var t=r;export default t;

