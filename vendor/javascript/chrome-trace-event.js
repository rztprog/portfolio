import e from"stream";import t from"process";var s={};var i=t;Object.defineProperty(s,"__esModule",{value:true});s.Tracer=void 0;const r=e;function evCommon(){var e=i.hrtime();var t=1e6*e[0]+Math.round(e[1]/1e3);return{ts:t,pid:i.pid,tid:i.pid}}class Tracer extends r.Readable{constructor(e={}){super();this.noStream=false;this.events=[];if("object"!==typeof e)throw new Error("Invalid options passed (must be an object)");if(null!=e.parent&&"object"!==typeof e.parent)throw new Error("Invalid option (parent) passed (must be an object)");if(null!=e.fields&&"object"!==typeof e.fields)throw new Error("Invalid option (fields) passed (must be an object)");if(null!=e.objectMode&&true!==e.objectMode&&false!==e.objectMode)throw new Error("Invalid option (objectsMode) passed (must be a boolean)");this.noStream=e.noStream||false;this.parent=e.parent;this.parent?this.fields=Object.assign({},e.parent&&e.parent.fields):this.fields={};e.fields&&Object.assign(this.fields,e.fields);this.fields.cat?Array.isArray(this.fields.cat)&&(this.fields.cat=this.fields.cat.join(",")):this.fields.cat="default";this.fields.args||(this.fields.args={});if(this.parent)this._push=this.parent._push.bind(this.parent);else{this._objectMode=Boolean(e.objectMode);var t={objectMode:this._objectMode};if(this._objectMode)this._push=this.push;else{this._push=this._pushString;t.encoding="utf8"}r.Readable.call(this,t)}}flush(){if(true===this.noStream){for(const e of this.events)this._push(e);this._flush()}}_read(e){}_pushString(e){var t="";if(this.firstPush)t=",\n";else{this.push("[");this.firstPush=true}this.push(t+JSON.stringify(e),"utf8")}_flush(){this._objectMode||this.push("]")}child(e){return new Tracer({parent:this,fields:e})}begin(e){return this.mkEventFunc("b")(e)}end(e){return this.mkEventFunc("e")(e)}completeEvent(e){return this.mkEventFunc("X")(e)}instantEvent(e){return this.mkEventFunc("I")(e)}mkEventFunc(e){return t=>{var s=evCommon();s.ph=e;if(t)if("string"===typeof t)s.name=t;else for(const e of Object.keys(t))"cat"===e?s.cat=t.cat.join(","):s[e]=t[e];this.noStream?this.events.push(s):this._push(s)}}}s.Tracer=Tracer;const n=s.__esModule;const o=s.Tracer;export default s;export{o as Tracer,n as __esModule};

