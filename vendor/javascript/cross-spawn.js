import n from"child_process";import r from"path";import"which";import"path-key";import o from"process";import e from"./lib/util/resolveCommand.js";import t from"fs";import s from"shebang-command";import c from"buffer";var a={};const i=/([()\][%!^"`<>&|;, *?])/g;function escapeCommand(n){n=n.replace(i,"^$1");return n}function escapeArgument(n,r){n=`${n}`;n=n.replace(/(\\*)"/g,'$1$1\\"');n=n.replace(/(\\*)$/,"$1$1");n=`"${n}"`;n=n.replace(i,"^$1");r&&(n=n.replace(i,"^$1"));return n}a.command=escapeCommand;a.argument=escapeArgument;var m={};var p=c.Buffer;const f=t;const l=s;function readShebang(n){const r=150;const o=p.alloc(r);let e;try{e=f.openSync(n,"r");f.readSync(e,o,0,r,0);f.closeSync(e)}catch(n){}return l(o.toString())}m=readShebang;var u=m;var d={};var g=o;const E=r;const y=e;const h=a;const N=u;const v="win32"===g.platform;const w=/\.(?:com|exe)$/i;const S=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function detectShebang(n){n.file=y(n);const r=n.file&&N(n.file);if(r){n.args.unshift(n.file);n.command=r;return y(n)}return n.file}function parseNonShell(n){if(!v)return n;const r=detectShebang(n);const o=!w.test(r);if(n.options.forceShell||o){const o=S.test(r);n.command=E.normalize(n.command);n.command=h.command(n.command);n.args=n.args.map(n=>h.argument(n,o));const e=[n.command].concat(n.args).join(" ");n.args=["/d","/s","/c",`"${e}"`];n.command=g.env.comspec||"cmd.exe";n.options.windowsVerbatimArguments=true}return n}function parse(n,r,o){if(r&&!Array.isArray(r)){o=r;r=null}r=r?r.slice(0):[];o=Object.assign({},o);const e={command:n,args:r,options:o,file:void 0,original:{command:n,args:r}};return o.shell?e:parseNonShell(e)}d=parse;var $=d;var O={};var b=o;const T="win32"===b.platform;function notFoundError(n,r){return Object.assign(new Error(`${r} ${n.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${r} ${n.command}`,path:n.command,spawnargs:n.args})}function hookChildProcess(n,r){if(!T)return;const o=n.emit;n.emit=function(e,t){if("exit"===e){const e=verifyENOENT(t,r,"spawn");if(e)return o.call(n,"error",e)}return o.apply(n,arguments)}}function verifyENOENT(n,r){return T&&1===n&&!r.file?notFoundError(r.original,"spawn"):null}function verifyENOENTSync(n,r){return T&&1===n&&!r.file?notFoundError(r.original,"spawnSync"):null}O={hookChildProcess:hookChildProcess,verifyENOENT:verifyENOENT,verifyENOENTSync:verifyENOENTSync,notFoundError:notFoundError};var _=O;var C={};const k=n;const x=$;const A=_;function spawn(n,r,o){const e=x(n,r,o);const t=k.spawn(e.command,e.args,e.options);A.hookChildProcess(t,e);return t}function spawnSync(n,r,o){const e=x(n,r,o);const t=k.spawnSync(e.command,e.args,e.options);t.error=t.error||A.verifyENOENTSync(t.status,e);return t}C=spawn;C.spawn=spawn;C.sync=spawnSync;C._parse=x;C._enoent=A;var F=C;const j=C.sync;const P=C.spawn,z=C._parse,B=C._enoent;export default F;export{B as _enoent,z as _parse,P as spawn,j as sync};

