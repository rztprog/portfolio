import e from"fs";import t from"path";import i from"util";var a="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var o={};var r=e;var l=t;var c=i;function Y18N(e){e=e||{};(this||a).directory=e.directory||"./locales";(this||a).updateFiles="boolean"!==typeof e.updateFiles||e.updateFiles;(this||a).locale=e.locale||"en";(this||a).fallbackToLanguage="boolean"!==typeof e.fallbackToLanguage||e.fallbackToLanguage;(this||a).cache=Object.create(null);(this||a).writeQueue=[]}Y18N.prototype.__=function(){if("string"!==typeof arguments[0])return(this||a)._taggedLiteral.apply(this||a,arguments);var e=Array.prototype.slice.call(arguments);var t=e.shift();var cb=function(){};"function"===typeof e[e.length-1]&&(cb=e.pop());cb=cb||function(){};(this||a).cache[(this||a).locale]||this._readLocaleFile();if(!(this||a).cache[(this||a).locale][t]&&(this||a).updateFiles){(this||a).cache[(this||a).locale][t]=t;this._enqueueWrite([(this||a).directory,(this||a).locale,cb])}else cb();return c.format.apply(c,[(this||a).cache[(this||a).locale][t]||t].concat(e))};Y18N.prototype._taggedLiteral=function(e){var t=arguments;var i="";e.forEach((function(e,a){var o=t[a+1];i+=e;"undefined"!==typeof o&&(i+="%s")}));return(this||a).__.apply(null,[i].concat([].slice.call(arguments,1)))};Y18N.prototype._enqueueWrite=function(e){(this||a).writeQueue.push(e);1===(this||a).writeQueue.length&&this._processWriteQueue()};Y18N.prototype._processWriteQueue=function(){var e=this||a;var t=(this||a).writeQueue[0];var i=t[0];var o=t[1];var l=t[2];var c=this._resolveLocaleFile(i,o);var s=JSON.stringify((this||a).cache[o],null,2);r.writeFile(c,s,"utf-8",(function(t){e.writeQueue.shift();e.writeQueue.length>0&&e._processWriteQueue();l(t)}))};Y18N.prototype._readLocaleFile=function(){var e={};var t=this._resolveLocaleFile((this||a).directory,(this||a).locale);try{e=JSON.parse(r.readFileSync(t,"utf-8"))}catch(i){i instanceof SyntaxError&&(i.message="syntax error in "+t);if("ENOENT"!==i.code)throw i;e={}}(this||a).cache[(this||a).locale]=e};Y18N.prototype._resolveLocaleFile=function(e,t){var i=l.resolve(e,"./",t+".json");if((this||a).fallbackToLanguage&&!this._fileExistsSync(i)&&~t.lastIndexOf("_")){var o=l.resolve(e,"./",t.split("_")[0]+".json");this._fileExistsSync(o)&&(i=o)}return i};Y18N.prototype._fileExistsSync=function(e){try{return r.statSync(e).isFile()}catch(e){return false}};Y18N.prototype.__n=function(){var e=Array.prototype.slice.call(arguments);var t=e.shift();var i=e.shift();var o=e.shift();var cb=function(){};"function"===typeof e[e.length-1]&&(cb=e.pop());(this||a).cache[(this||a).locale]||this._readLocaleFile();var r=1===o?t:i;(this||a).cache[(this||a).locale][t]&&(r=(this||a).cache[(this||a).locale][t][1===o?"one":"other"]);if(!(this||a).cache[(this||a).locale][t]&&(this||a).updateFiles){(this||a).cache[(this||a).locale][t]={one:t,other:i};this._enqueueWrite([(this||a).directory,(this||a).locale,cb])}else cb();var l=[r];~r.indexOf("%d")&&l.push(o);return c.format.apply(c,l.concat(e))};Y18N.prototype.setLocale=function(e){(this||a).locale=e};Y18N.prototype.getLocale=function(){return(this||a).locale};Y18N.prototype.updateLocale=function(e){(this||a).cache[(this||a).locale]||this._readLocaleFile();for(var t in e)(this||a).cache[(this||a).locale][t]=e[t]};o=function(e){var t=new Y18N(e);for(var i in t)"function"===typeof t[i]&&(t[i]=t[i].bind(t));return t};var s=o;export default s;

