import t from"readable-stream";import i from"inherits";import r from"cyclist";import e from"util";var o="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var s={};var h=t.Transform;var n=i;var f=r;var a=e;var ParallelTransform=function(t,i,r){if(!((this||o)instanceof ParallelTransform))return new ParallelTransform(t,i,r);if("function"===typeof t){r=t;i=null;t=1}if("function"===typeof i){r=i;i=null}i||(i={});i.highWaterMark||(i.highWaterMark=Math.max(t,16));false!==i.objectMode&&(i.objectMode=true);h.call(this||o,i);(this||o)._maxParallel=t;(this||o)._ontransform=r;(this||o)._destroyed=false;(this||o)._flushed=false;(this||o)._ordered=false!==i.ordered;(this||o)._buffer=(this||o)._ordered?f(t):[];(this||o)._top=0;(this||o)._bottom=0;(this||o)._ondrain=null};n(ParallelTransform,h);ParallelTransform.prototype.destroy=function(){if(!(this||o)._destroyed){(this||o)._destroyed=true;this.emit("close")}};ParallelTransform.prototype._transform=function(t,i,r){var e=this||o;var s=(this||o)._top++;this._ontransform(t,(function(t,i){if(!e._destroyed)if(t){e.emit("error",t);e.push(null);e.destroy()}else{e._ordered?e._buffer.put(s,void 0===i||null===i?null:i):e._buffer.push(i);e._drain()}}));if((this||o)._top-(this||o)._bottom<(this||o)._maxParallel)return r();(this||o)._ondrain=r};ParallelTransform.prototype._flush=function(t){(this||o)._flushed=true;(this||o)._ondrain=t;this._drain()};ParallelTransform.prototype._drain=function(){if((this||o)._ordered)while(void 0!==(this||o)._buffer.get((this||o)._bottom)){var t=(this||o)._buffer.del((this||o)._bottom++);null!==t&&this.push(t)}else while((this||o)._buffer.length>0){var t=(this||o)._buffer.pop();(this||o)._bottom++;null!==t&&this.push(t)}if(this._drained()&&(this||o)._ondrain){var i=(this||o)._ondrain;(this||o)._ondrain=null;i()}};ParallelTransform.prototype._drained=function(){var t=(this||o)._top-(this||o)._bottom;return(this||o)._flushed?!t:t<(this||o)._maxParallel};s=ParallelTransform;var l=s;export default l;

