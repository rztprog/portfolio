import"path";import t from"events";import"neo-async";import"chokidar";import"watchpack-chokidar2";import{d as e}from"../_/5e0817bb.js";import"graceful-fs";import"process";var i={},a=false;function dew(){if(a)return i;a=true;var r=e();var o=t.EventEmitter;function Watchpack(t){o.call(this);t||(t={});t.aggregateTimeout||(t.aggregateTimeout=200);this.options=t;this.watcherOptions={ignored:t.ignored,poll:t.poll};this.fileWatchers=[];this.dirWatchers=[];this.mtimes=Object.create(null);this.paused=false;this.aggregatedChanges=[];this.aggregatedRemovals=[];this.aggregateTimeout=0;this._onTimeout=this._onTimeout.bind(this)}i=Watchpack;Watchpack.prototype=Object.create(o.prototype);Watchpack.prototype.watch=function watch(t,e,i){this.paused=false;var a=this.fileWatchers;var o=this.dirWatchers;this.fileWatchers=t.map((function(t){return this._fileWatcher(t,r.watchFile(t,this.watcherOptions,i))}),this);this.dirWatchers=e.map((function(t){return this._dirWatcher(t,r.watchDirectory(t,this.watcherOptions,i))}),this);a.forEach((function(t){t.close()}),this);o.forEach((function(t){t.close()}),this)};Watchpack.prototype.close=function resume(){this.paused=true;this.aggregateTimeout&&clearTimeout(this.aggregateTimeout);this.fileWatchers.forEach((function(t){t.close()}),this);this.dirWatchers.forEach((function(t){t.close()}),this);this.fileWatchers.length=0;this.dirWatchers.length=0};Watchpack.prototype.pause=function pause(){this.paused=true;this.aggregateTimeout&&clearTimeout(this.aggregateTimeout)};function addWatchersToArray(t,e){t.forEach((function(t){if(e.indexOf(t.directoryWatcher)<0){e.push(t.directoryWatcher);addWatchersToArray(Object.keys(t.directoryWatcher.directories).reduce((function(e,i){true!==t.directoryWatcher.directories[i]&&e.push(t.directoryWatcher.directories[i]);return e}),[]),e)}}))}Watchpack.prototype.getTimes=function(){var t=[];addWatchersToArray(this.fileWatchers.concat(this.dirWatchers),t);var e=Object.create(null);t.forEach((function(t){var i=t.getTimes();Object.keys(i).forEach((function(t){e[t]=i[t]}))}));return e};Watchpack.prototype._fileWatcher=function _fileWatcher(t,e){e.on("change",function(e,i){this._onChange(t,e,t,i)}.bind(this));e.on("remove",function(e){this._onRemove(t,t,e)}.bind(this));return e};Watchpack.prototype._dirWatcher=function _dirWatcher(t,e){e.on("change",function(e,i,a){this._onChange(t,i,e,a)}.bind(this));return e};Watchpack.prototype._onChange=function _onChange(t,e,i){i=i||t;this.mtimes[i]=e;if(!this.paused){this.emit("change",i,e);this.aggregateTimeout&&clearTimeout(this.aggregateTimeout);this.aggregatedChanges.indexOf(t)<0&&this.aggregatedChanges.push(t);this.aggregateTimeout=setTimeout(this._onTimeout,this.options.aggregateTimeout)}};Watchpack.prototype._onRemove=function _onRemove(t,e){e=e||t;delete this.mtimes[t];if(!this.paused){this.emit("remove",t);this.aggregateTimeout&&clearTimeout(this.aggregateTimeout);this.aggregatedRemovals.indexOf(t)<0&&this.aggregatedRemovals.push(t);this.aggregateTimeout=setTimeout(this._onTimeout,this.options.aggregateTimeout)}};Watchpack.prototype._onTimeout=function _onTimeout(){this.aggregateTimeout=0;var t=this.aggregatedChanges;var e=this.aggregatedRemovals;this.aggregatedChanges=[];this.aggregatedRemovals=[];this.emit("aggregated",t,e)};return i}var r=dew();export default r;export{dew as __dew};

